# ğŸŒ± CareLine - åŒ–ç–—å‘¨æœŸå‰¯ä½œç”¨ç®¡ç†ç³»ç»Ÿ

> ç›´è‚ ç™Œæ™šæœŸå®šåˆ¶ Â· å®¶åº­å†…éƒ¨ä½¿ç”¨ Â· è®©è®°å½•æ›´ç®€å•

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ React   â”‚â”€â”€â”€â”€â–¶â”‚  Nginx HTTPS â”‚â”€â”€â”€â”€â–¶â”‚  FastAPI    â”‚
â”‚  (Vite æ„å»º)  â”‚     â”‚  åå‘ä»£ç†     â”‚     â”‚  åç«¯ API   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                          â”‚ PostgreSQL  â”‚
                                          â”‚   æ•°æ®åº“     â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é¡¹ç›®ç»“æ„

```
careline/
â”œâ”€â”€ backend/                    # FastAPI åç«¯
â”‚   â”œâ”€â”€ main.py                 # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ models.py               # SQLAlchemy æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ schemas.py              # Pydantic è¯·æ±‚/å“åº” schema
â”‚   â”œâ”€â”€ database.py             # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ auth.py                 # JWT è®¤è¯
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ auth_router.py      # ç™»å½•/æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ family_router.py    # å®¶åº­ç©ºé—´ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ cycle_router.py     # åŒ–ç–—ç–—ç¨‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ daily_router.py     # æ¯æ—¥è®°å½• CRUD
â”‚   â”‚   â”œâ”€â”€ stool_router.py     # æ’ä¾¿å³æ—¶è®°å½•
â”‚   â”‚   â”œâ”€â”€ summary_router.py   # è¶‹åŠ¿ + å°±è¯Šæ‘˜è¦
â”‚   â”‚   â””â”€â”€ message_router.py   # å®¶äººç•™è¨€
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/                   # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.jsx             # ä¸»åº”ç”¨ï¼ˆç™»å½•/å…¥é©»/ä¸»ç•Œé¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ utils/api.js        # API å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â””â”€â”€ hooks/useCareline.js # æ•°æ®è·å– hooks
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ default.conf            # Nginx é…ç½®
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ backup.sh               # æ•°æ®åº“å¤‡ä»½è„šæœ¬
â”œâ”€â”€ docker-compose.yml          # ä¸€é”®éƒ¨ç½²
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ README.md
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

- è…¾è®¯äº‘ VMï¼ˆUbuntu 22.04+ï¼‰
- Docker + Docker Compose
- åŸŸå + SSL è¯ä¹¦ï¼ˆå¾®ä¿¡å°ç¨‹åºè¦æ±‚ HTTPSï¼‰

### 2. éƒ¨ç½²æ­¥éª¤

```bash
# å…‹éš†é¡¹ç›®
git clone <your-repo> careline && cd careline

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env  # ä¿®æ”¹å¯†ç å’Œå¯†é’¥

# æ„å»ºå‰ç«¯
cd frontend && npm install && npm run build && cd ..

# æ”¾ç½® SSL è¯ä¹¦
mkdir -p nginx/ssl
cp your-cert.pem nginx/ssl/cert.pem
cp your-key.pem nginx/ssl/key.pem

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æŸ¥çœ‹çŠ¶æ€
docker compose ps
docker compose logs -f backend
```

### 3. æœ¬åœ°å¼€å‘

```bash
# åç«¯
cd backend
pip install -r requirements.txt
# éœ€è¦æœ¬åœ° PostgreSQL æˆ–ä¿®æ”¹ DATABASE_URL
uvicorn main:app --reload --port 8000

# å‰ç«¯ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
cd frontend
npm install
npm run dev
# è®¿é—® http://localhost:5173
# API è‡ªåŠ¨ä»£ç†åˆ° http://localhost:8000
```

## API æ–‡æ¡£

å¯åŠ¨åç«¯åè®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹äº¤äº’å¼ API æ–‡æ¡£ã€‚

### æ ¸å¿ƒæ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/auth/register` | æ‰‹æœºå·æ³¨å†Œ |
| POST | `/auth/login` | æ‰‹æœºå·ç™»å½• |
| POST | `/auth/wechat` | å¾®ä¿¡ç™»å½• |
| POST | `/family/create` | åˆ›å»ºå®¶åº­ç©ºé—´ |
| POST | `/family/join` | é‚€è¯·ç åŠ å…¥å®¶åº­ |
| GET  | `/family/me` | æˆ‘çš„å®¶åº­ä¸è§’è‰² |
| POST | `/cycle` | åˆ›å»º/æ›´æ–°ç–—ç¨‹ |
| GET  | `/cycle/current` | å½“å‰ç–—ç¨‹ä¿¡æ¯ |
| PUT  | `/daily/{date}` | Upsert å½“å¤©è®°å½• |
| GET  | `/daily/today` | ä»Šæ—¥è®°å½• |
| GET  | `/daily/cycle/{no}` | æœ¬ç–—ç¨‹æ•°æ® |
| POST | `/stool` | è®°å½•ä¸€æ¬¡æ’ä¾¿ï¼ˆå³æ—¶ï¼‰ |
| GET  | `/stool/today` | ä»Šæ—¥æ’ä¾¿æ±‡æ€» |
| GET  | `/summary` | è¶‹åŠ¿ + å°±è¯Šæ‘˜è¦ |
| GET  | `/summary/calendar` | çŠ¶æ€æ—¥å†æ•°æ® |
| POST | `/message` | å‘é€å®¶äººç•™è¨€ |
| GET  | `/message/active` | è·å–æ´»è·ƒç•™è¨€ |

## è®¾è®¡äº®ç‚¹

### è§’è‰²åˆ†å±‚ï¼ˆåŒä¸€æ•°æ®ï¼Œä¸åŒè§†è§’ï¼‰

- **æ‚£è€…ç«¯**ï¼šæš–è‰²è°ƒã€é¼“åŠ±æ€§æªè¾ã€çŠ¶æ€æ—¥å†ï¼ˆemojiï¼‰ã€æ— è¶‹åŠ¿æ›²çº¿
- **å®¶å±ç«¯**ï¼šä¸´åºŠè“è‰²è°ƒã€æ•°å€¼è¯„åˆ†ã€å®Œæ•´è¶‹åŠ¿å›¾ã€è·¨ç–—ç¨‹å¯¹æ¯”

### å…³çˆ±è®¾è®¡

- **"ä»Šå¤©å¾ˆéš¾å—"å¿«æ·æ¨¡å¼**ï¼šåªé—®ä½“æ¸©ï¼Œå…¶ä»–ç”¨æ˜¨å¤©æ•°æ®å¡«å……
- **æ’ä¾¿æµ®åŠ¨æŒ‰é’®**ï¼šæ¯æ¬¡æ’ä¾¿å³æ—¶è®°å½•ï¼Œ10ç§’å®Œæˆ
- **å®¶äººç•™è¨€**ï¼šå®¶å±å†™é¼“åŠ±çš„è¯ï¼Œæ‚£è€…é¦–é¡µå¯è§
- **è¿ç»­è®°å½•æ¿€åŠ±**ï¼šæ—¥å†æ˜¾ç¤ºè®°å½•å¤©æ•°å’Œ"çŠ¶æ€ä¸é”™"ç»Ÿè®¡

### å°±è¯Šæ²Ÿé€š

- è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦æ–‡æœ¬
- åŒ…å«å³°å€¼ã€å‡å€¼ã€å‘çƒ­äº‹ä»¶ã€æœ€éš¾å—3å¤©
- ä¸€é”®å¤åˆ¶/å¾®ä¿¡åˆ†äº«ç»™åŒ»ç”Ÿ

## æ•°æ®åº“å¤‡ä»½

```bash
# æ‰‹åŠ¨å¤‡ä»½
bash scripts/backup.sh

# è®¾ç½®æ¯æ—¥è‡ªåŠ¨å¤‡ä»½ï¼ˆå‡Œæ™¨3ç‚¹ï¼‰
crontab -e
# æ·»åŠ : 0 3 * * * /home/ubuntu/careline/scripts/backup.sh
```

## å¾®ä¿¡å°ç¨‹åºé€‚é…

å½“å‰ä¸º Web App ç‰ˆæœ¬ã€‚å¦‚éœ€å‘å¸ƒä¸ºå¾®ä¿¡å°ç¨‹åºï¼Œæ¨èä½¿ç”¨ [Taro](https://taro.jd.com/) æ¡†æ¶å°† React ä»£ç ç¼–è¯‘ä¸ºå°ç¨‹åºï¼š

1. ä½¿ç”¨ Taro åˆå§‹åŒ–é¡¹ç›®
2. è¿ç§» React ç»„ä»¶ï¼ˆå¤§éƒ¨åˆ†å¯ç›´æ¥å¤ç”¨ï¼‰
3. å°† `fetch` æ›¿æ¢ä¸º `Taro.request`
4. å¾®ä¿¡ç™»å½•å¯¹æ¥ `wx.login()` â†’ `/auth/wechat`

## è¿­ä»£è®¡åˆ’

- [x] V1: æ ¸å¿ƒè®°å½• + è¶‹åŠ¿ + æ‘˜è¦ + è§’è‰²åˆ†å±‚
- [ ] V1.1: ç”¨è¯æé†’ï¼ˆæ­¢å/æ­¢æ³»/æ­¢ç—›ï¼‰
- [ ] V1.2: æ¯æ™šæé†’æ¨é€ + è¿ç»­è®°å½•å¥–åŠ±
- [ ] V2: é¥®é£Ÿååº”åˆ†æ + è¯­éŸ³ç•™è¨€
