<!-- pages/settings/settings.wxml -->
<view class="settings-page">

  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="card user-card">
    <text class="user-emoji">{{isPatient ? 'ğŸ§‘â€ğŸ¦³' : 'ğŸ‘¨â€âš•ï¸'}}</text>
    <view class="user-info">
      <text class="user-name">{{nickname || 'ç”¨æˆ·'}}</text>
      <text class="user-role">{{isPatient ? 'æ‚£è€…' : 'å®¶å±/ç…§æŠ¤è€…'}}</text>
    </view>
  </view>

  <!-- ç–—ç¨‹ä¿¡æ¯ -->
  <view class="card">
    <text class="section-title">ğŸ’Š å½“å‰ç–—ç¨‹</text>
    <view wx:if="{{cycleNo > 0}}" class="cycle-info">
      <text class="cycle-text">ç¬¬{{cycleNo}}ç–—ç¨‹ Â· Day {{cycleDay}}</text>
      <text class="cycle-start">å¼€å§‹æ—¥æœŸ: {{startDate}}</text>
    </view>
    <text wx:else class="empty-hint">æš‚æ— ç–—ç¨‹</text>

    <view class="divider"></view>
    <view wx:if="{{!showNewCycle}}">
      <button class="btn-outline" bindtap="toggleNewCycle">+ æ–°å»ºç–—ç¨‹</button>
    </view>
    <view wx:else class="new-cycle-form">
      <view class="input-group">
        <text class="input-label">ç¬¬å‡ ç–—ç¨‹</text>
        <input type="number" value="{{newCycleNo}}" bindinput="onNewCycleNoInput" class="input-field" />
      </view>
      <view class="input-group">
        <text class="input-label">å¼€å§‹æ—¥æœŸ</text>
        <picker mode="date" value="{{newStartDate}}" bindchange="onNewStartDateChange">
          <view class="input-field picker-field">{{newStartDate || 'é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      <button class="btn-primary" bindtap="onCreateCycle">åˆ›å»º</button>
      <button class="btn-outline" bindtap="toggleNewCycle" style="margin-top: 12rpx;">å–æ¶ˆ</button>
    </view>
  </view>

  <!-- å®¶åº­ä¿¡æ¯ -->
  <view class="card">
    <text class="section-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶åº­</text>
    <view class="info-row">
      <text class="info-label">å®¶åº­åç§°</text>
      <text class="info-value">{{familyName}}</text>
    </view>
    <view class="info-row" bindtap="copyInviteCode">
      <text class="info-label">é‚€è¯·ç </text>
      <text class="info-value invite-code">{{inviteCode}} ğŸ“‹</text>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£ -->
  <view class="card" wx:if="{{!isPatient}}">
    <view class="menu-item" bindtap="goSummary">
      <text>ğŸ“‹ å°±è¯Šæ‘˜è¦</text>
      <text class="menu-arrow">â€º</text>
    </view>
  </view>

  <!-- é€€å‡º -->
  <button class="btn-logout" bindtap="onLogout">é€€å‡ºç™»å½•</button>
</view>
