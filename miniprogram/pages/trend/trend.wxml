<!-- pages/trend/trend.wxml -->
<view class="trend-page">
  <view wx:if="{{loading}}" class="loading-center">åŠ è½½ä¸­...</view>

  <!-- æ‚£è€…ï¼šæ—¥å†è§†å›¾ -->
  <view wx:elif="{{isPatient}}">
    <view class="cal-header">
      <text class="cal-month">{{calMonth}}</text>
      <text class="cal-streak" wx:if="{{streak > 0}}">ğŸ”¥ è¿ç»­è®°å½•{{streak}}å¤©</text>
    </view>

    <view class="card cal-card">
      <view class="cal-weekdays">
        <text wx:for="{{['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']}}" wx:key="index" class="cal-weekday">{{item}}</text>
      </view>

      <view class="cal-grid">
        <view
          wx:for="{{calendarDays}}" wx:key="index"
          class="cal-day {{item.empty ? 'empty' : ''}} {{item.isToday ? 'today' : ''}} {{item.hasLog ? 'logged' : ''}}"
        >
          <block wx:if="{{!item.empty}}">
            <text class="cal-day-num">{{item.day}}</text>
            <text class="cal-day-emoji" wx:if="{{item.emoji}}">{{item.emoji}}</text>
            <text class="cal-day-cycle" wx:if="{{item.cycleDay}}">D{{item.cycleDay}}</text>
          </block>
        </view>
      </view>
    </view>

    <view class="legend">
      <text class="legend-item">ğŸ˜Š çŠ¶æ€å¥½</text>
      <text class="legend-item">ğŸ˜ ä¸€èˆ¬</text>
      <text class="legend-item">ğŸ˜” è¾ƒè¾›è‹¦</text>
    </view>
  </view>

  <!-- å®¶å±ï¼šè¶‹åŠ¿æ•°æ®è¡¨ -->
  <view wx:else>
    <view class="card">
      <text class="section-title">ç¬¬{{cycleNo}}ç–—ç¨‹è¶‹åŠ¿</text>

      <view wx:if="{{trendData.length === 0}}" class="empty-hint">æš‚æ— æ•°æ®</view>

      <view wx:else class="trend-table">
        <view class="trend-row trend-header">
          <text class="trend-cell">Day</text>
          <text class="trend-cell">ä½“åŠ›</text>
          <text class="trend-cell">æ¶å¿ƒ</text>
          <text class="trend-cell">æ’ä¾¿</text>
          <text class="trend-cell">å‘çƒ­</text>
        </view>
        <view wx:for="{{trendData}}" wx:key="cycle_day" class="trend-row">
          <text class="trend-cell day-cell">D{{item.cycle_day}}</text>
          <text class="trend-cell">
            <text class="bar" style="width: {{item.energy ? (item.energy * 25) : 0}}%; background: #5B7FE8;"></text>
            {{item.energy != null ? item.energy : '-'}}
          </text>
          <text class="trend-cell">
            <text class="bar" style="width: {{item.nausea ? (item.nausea * 33) : 0}}%; background: #E8A85B;"></text>
            {{item.nausea != null ? item.nausea : '-'}}
          </text>
          <text class="trend-cell">{{item.stool_count != null ? item.stool_count : '-'}}</text>
          <text class="trend-cell {{item.fever ? 'danger' : ''}}">{{item.fever ? 'ğŸŒ¡ï¸' : 'â€”'}}</text>
        </view>
      </view>
    </view>

    <button class="btn-primary summary-btn" bindtap="goSummary">ğŸ“‹ æŸ¥çœ‹å°±è¯Šæ‘˜è¦</button>
  </view>
</view>
